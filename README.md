# RAG –ü–∞–π–ø–ª–∞–π–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞

–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ RAG –ø–æ–¥—Ö–æ–¥–∞ –∏ 7 –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π.

**‚Üí [QUICKSTART.md](QUICKSTART.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 3 –º–∏–Ω—É—Ç—ã**

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. ‚úÖ **Cross-Encoder Reranking** - —Ç–æ—á–Ω–æ–µ –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (+15-25% accuracy)
2. ‚úÖ **Query Expansion** - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ (+5-10%)
3. ‚úÖ **Reciprocal Rank Fusion** - —É–º–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ Dense + BM25 (+8-12%)
4. ‚úÖ **Context Window** - —Å–æ—Å–µ–¥–Ω–∏–µ —á–∞–Ω–∫–∏ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã (+10-15%)
5. ‚úÖ **Query Reformulation** - LLM —É–ª—É—á—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (+8-12%)
6. ‚úÖ **Multi-hop Reasoning** - –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (+15-25%)
7. ‚úÖ **LLM Document Cleaning** - –æ—á–∏—Å—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ LLM (+10-20%)

### –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- üîß **Grid Search –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- üßπ **LLM preprocessing** - —É–º–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- üöÄ **A100 80GB –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–°—É–º–º–∞—Ä–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç accuracy: +70-115% –Ω–∞–¥ baseline!**

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Offline (–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π):

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** - –∏–∑ `websites.csv`
2. **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞** - –æ—á–∏—Å—Ç–∫–∞, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, —Å–∏–Ω–æ–Ω–∏–º—ã
3. **LLM Cleaning** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, `--llm-clean`):
   - –£–¥–∞–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞ (–Ω–∞–≤–∏–≥–∞—Ü–∏—è, —Ñ—É—Ç–µ—Ä—ã, —Ä–µ–∫–ª–∞–º–∞)
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π (products, actions, conditions, topics)
   - –û—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ—Ä–æ–≥—É –∫–∞—á–µ—Å—Ç–≤–∞
4. **–ß–∞–Ω–∫–∏–Ω–≥** - —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (200 —Å–ª–æ–≤, –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 50)
5. **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**:
   - –í–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å: BGE-M3 embeddings (FAISS –∏–ª–∏ Weaviate)
   - BM25 –∏–Ω–¥–µ–∫—Å: –ª–µ–∫—Å–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫

### Online (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤):

1. **Query Reformulation** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - LLM —É–ª—É—á—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
2. **Query Expansion** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∏–Ω–æ–Ω–∏–º–æ–≤
3. **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫**:
   - Dense: –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (BGE-M3)
   - BM25: keyword –ø–æ–∏—Å–∫
4. **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ RRF** - Reciprocal Rank Fusion
5. **Cross-Encoder Reranking** - —Ç–æ—á–Ω–æ–µ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ø-20
6. **Context Window** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å–µ–¥–Ω–∏—Ö —á–∞–Ω–∫–æ–≤
7. **Multi-hop** (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤) - –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫
8. **–í—ã–±–æ—Ä —Ç–æ–ø-5** - —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

### Grid Search –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, `--optimize`):
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä TOP_K_DENSE, TOP_K_BM25, TOP_K_RERANK, HYBRID_ALPHA
- –†–µ–∂–∏–º—ã: `quick` (54 –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏) –∏–ª–∏ `full` (1225 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ª—É—á—à–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫ config

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
–ê–ª—å—Ñ–∞RAg/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config.py                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ preprocessing.py           # –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ chunking.py                # –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ indexing.py                # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ retrieval.py               # –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ –∏ RAG pipeline
‚îÇ   ‚îú‚îÄ‚îÄ llm_preprocessing.py       # üÜï LLM –æ—á–∏—Å—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ grid_search_optimizer.py   # üÜï Grid search –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ cross_encoder_reranker.py  # Cross-Encoder reranking
‚îÇ   ‚îú‚îÄ‚îÄ query_expansion.py         # Query expansion
‚îÇ   ‚îú‚îÄ‚îÄ query_reformulation.py     # Query reformulation
‚îÇ   ‚îú‚îÄ‚îÄ reciprocal_rank_fusion.py  # Reciprocal Rank Fusion
‚îÇ   ‚îú‚îÄ‚îÄ context_window.py          # Context window expansion
‚îÇ   ‚îî‚îÄ‚îÄ multi_hop_reasoning.py     # Multi-hop reasoning
‚îú‚îÄ‚îÄ scripts/                       # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ processed/                 # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ models/                        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ LLM –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ outputs/                       # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚îú‚îÄ‚îÄ docs/                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ FUTURE_IMPROVEMENTS.md     # –ò–¥–µ–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π
‚îú‚îÄ‚îÄ main_pipeline.py               # üöÄ –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
‚îú‚îÄ‚îÄ websites.csv                   # –ë–∞–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ questions_clean.csv            # –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ examples_for_participants.csv  # –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
‚îú‚îÄ‚îÄ FINAL_IMPROVEMENTS_SUMMARY.md  # üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –≤—Å–µ—Ö —É–ª—É—á—à–µ–Ω–∏–π
‚îú‚îÄ‚îÄ NEW_IMPROVEMENTS_GUIDE.md      # üìö –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–ª—É—á—à–µ–Ω–∏—è–º
‚îî‚îÄ‚îÄ README.md                      # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 2. –ó–∞–ø—É—Å–∫ Weaviate (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
docker-compose up -d

# 3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ LLM –º–æ–¥–µ–ª–∏ (–¥–ª—è --llm-clean –∏ query reformulation)
# –°–∫–∞—á–∞–π—Ç–µ Qwen3-32B-2507-Q8_0.gguf –≤ –ø–∞–ø–∫—É models/
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–±–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

```bash
# 1. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
python main_pipeline.py build

# 2. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã
python main_pipeline.py search

# –†–µ–∑—É–ª—å—Ç–∞—Ç: outputs/submission.csv
```

**–í—Ä–µ–º—è:** ~10-12 —á–∞—Å–æ–≤
**Accuracy:** 0.75-0.85

---

### ‚ö° –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π (–æ–±—ã—á–Ω–∞—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞)
python main_pipeline.py build

# 2. –ü–æ–∏—Å–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
python main_pipeline.py search --optimize

# Grid search –Ω–∞–π–¥–µ—Ç –ª—É—á—à–∏–µ TOP_K –∏ HYBRID_ALPHA
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

**–í—Ä–µ–º—è:** ~12-14 —á–∞—Å–æ–≤ (–≤–∫–ª—é—á–∞—è grid search)
**Accuracy:** 0.80-0.88
**–ü—Ä–∏—Ä–æ—Å—Ç:** +10-15% –Ω–∞–¥ –±–∞–∑–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

**–û–ø—Ü–∏–∏ grid search:**
```bash
# –ë—ã—Å—Ç—Ä–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (54 –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏, ~1 —á–∞—Å)
python main_pipeline.py search --optimize --optimize-mode quick

# –ü–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1225 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π, ~3-4 —á–∞—Å–∞)
python main_pipeline.py search --optimize --optimize-mode full --optimize-sample 100
```

---

### üî• –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–¥–ª—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π)

```bash
# –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å LLM –æ—á–∏—Å—Ç–∫–æ–π –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
python main_pipeline.py all --llm-clean --optimize

# –ü—Ä–æ—Ü–µ—Å—Å:
# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
# 2. LLM –æ—á–∏—Å—Ç–∫–∞ (4-6 —á–∞—Å–æ–≤) - —É–¥–∞–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
# 3. –ß–∞–Ω–∫–∏–Ω–≥ + –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ (2-3 —á–∞—Å–∞)
# 4. Grid search –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1-2 —á–∞—Å–∞)
# 5. –ü–æ–∏—Å–∫ –æ—Ç–≤–µ—Ç–æ–≤ —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (8-12 —á–∞—Å–æ–≤)
```

**–í—Ä–µ–º—è:** ~20-25 —á–∞—Å–æ–≤
**Accuracy:** 0.90-0.95+
**–ü—Ä–∏—Ä–æ—Å—Ç:** +70-115% –Ω–∞–¥ baseline!

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã LLM –æ—á–∏—Å—Ç–∫–∏:**
```bash
# –° –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
python main_pipeline.py build --llm-clean --min-usefulness 0.5

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
#   --min-usefulness: –ø–æ—Ä–æ–≥ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ (0.0-1.0, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.3)
#     0.0-0.3: –º—É—Å–æ—Ä (–Ω–∞–≤–∏–≥–∞—Ü–∏—è, —Ä–µ–∫–ª–∞–º–∞)
#     0.4-0.6: —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–ª–µ–∑–Ω–æ
#     0.7-1.0: –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ
```

---

## –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏ –æ–ø—Ü–∏–∏

### 1. BUILD - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

```bash
# –ë–∞–∑–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞
python main_pipeline.py build

# –° –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–æ–≤
python main_pipeline.py build --force

# –° LLM –æ—á–∏—Å—Ç–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–º–µ–¥–ª–µ–Ω–Ω–æ, +–∫–∞—á–µ—Å—Ç–≤–æ)
python main_pipeline.py build --llm-clean

# –° —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏
python main_pipeline.py build --llm-clean --min-usefulness 0.5
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç `websites.csv`
- –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ (–æ—á–∏—Å—Ç–∫–∞, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è)
- [–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ] LLM –æ—á–∏—Å—Ç–∫–∞ —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –†–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ —á–∞–Ω–∫–∏ (200 —Å–ª–æ–≤, overlap 50)
- –°–æ–∑–¥–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å (BGE-M3)
- –°–æ–∑–¥–∞–µ—Ç BM25 –∏–Ω–¥–µ–∫—Å
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `models/` –∏ `data/processed/`

---

### 2. SEARCH - –ü–æ–∏—Å–∫ –æ—Ç–≤–µ—Ç–æ–≤

```bash
# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
python main_pipeline.py search

# –¢–µ—Å—Ç –Ω–∞ N –≤–æ–ø—Ä–æ—Å–∞—Ö
python main_pipeline.py search --limit 10

# –° –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
python main_pipeline.py search --optimize

# –ü–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ –ª—É—á—à–µ)
python main_pipeline.py search --optimize --optimize-mode full --optimize-sample 100
```

**–û–ø—Ü–∏–∏:**
- `--limit N` - –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–µ—Ä–≤—ã–µ N –≤–æ–ø—Ä–æ—Å–æ–≤ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- `--optimize` - –∑–∞–ø—É—Å—Ç–∏—Ç—å grid search –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `--optimize-mode` - —Ä–µ–∂–∏–º: `quick` (–±—ã—Å—Ç—Ä–æ) –∏–ª–∏ `full` (–¥–æ–ª–≥–æ)
- `--optimize-sample N` - —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –¥–ª—è grid search (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –∏–∑ `models/`
- [–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ] Grid search –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ RAG pipeline:
  - Query reformulation (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
  - Query expansion
  - Hybrid search (Dense + BM25)
  - RRF –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ
  - Cross-Encoder reranking
  - Context window expansion
  - Multi-hop (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `outputs/submission.csv`

---

### 3. ALL - –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª

```bash
# –ë–∞–∑–æ–≤—ã–π –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª
python main_pipeline.py all

# –° LLM –æ—á–∏—Å—Ç–∫–æ–π
python main_pipeline.py all --llm-clean

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
python main_pipeline.py all --llm-clean --optimize

# –° —Ç–µ—Å—Ç–æ–º –Ω–∞ 50 –≤–æ–ø—Ä–æ—Å–∞—Ö
python main_pipeline.py all --force --limit 50
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** BUILD + SEARCH –≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ

---

### 4. EVALUATE - –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

```bash
python main_pipeline.py evaluate
```

---

### 5. –°–ø—Ä–∞–≤–∫–∞

```bash
# –í—Å–µ –∫–æ–º–∞–Ω–¥—ã
python main_pipeline.py --help

# –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–µ
python main_pipeline.py build --help
python main_pipeline.py search --help
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (src/config.py)

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```python
# –ß–∞–Ω–∫–∏–Ω–≥
CHUNK_SIZE = 200           # —Å–ª–æ–≤ –≤ —á–∞–Ω–∫–µ
CHUNK_OVERLAP = 50         # –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ

# Embedding –º–æ–¥–µ–ª—å
EMBEDDING_MODEL = "BAAI/bge-m3"  # BGE-M3 (–ª—É—á—à–∞—è –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ)

# –ü–æ–∏—Å–∫ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ --optimize)
TOP_K_DENSE = 25           # —Ç–æ–ø-K –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
TOP_K_BM25 = 25            # —Ç–æ–ø-K BM25
TOP_K_RERANK = 20          # —Ç–æ–ø-K –ø–æ—Å–ª–µ reranking
HYBRID_ALPHA = 0.5         # –≤–µ—Å Dense (1-alpha –¥–ª—è BM25)

# –£–ª—É—á—à–µ–Ω–∏—è (–≤–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
ENABLE_RRF = True                    # Reciprocal Rank Fusion
ENABLE_CONTEXT_WINDOW = True         # Context Window
ENABLE_QUERY_EXPANSION = True        # Query Expansion

# –£–ª—É—á—à–µ–Ω–∏—è (–≤—ã–∫–ª—é—á–µ–Ω—ã, —Ç—Ä–µ–±—É—é—Ç LLM)
ENABLE_QUERY_REFORMULATION = False   # Query Reformulation (–º–µ–¥–ª–µ–Ω–Ω–æ)
ENABLE_MULTI_HOP = False             # Multi-hop reasoning (–º–µ–¥–ª–µ–Ω–Ω–æ)

# Reranker
RERANKER_TYPE = "cross_encoder"      # cross_encoder | llm | none

# LLM –º–æ–¥–µ–ª—å (–¥–ª—è --llm-clean –∏ reformulation)
LLM_MODEL_FILE = "Qwen3-32B-2507-Q8_0.gguf"  # 32B 8-bit (34 GB VRAM)
```

### –í–∫–ª—é—á–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π:

```python
# –í src/config.py –∏–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

# Query Reformulation (LLM —É–ª—É—á—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã)
ENABLE_QUERY_REFORMULATION = True
QUERY_REFORMULATION_METHOD = "simple"  # simple | expanded | multi | all

# Multi-hop Reasoning (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤)
ENABLE_MULTI_HOP = True
MAX_HOPS = 3  # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π

# Context Window (—Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞)
CONTEXT_WINDOW_SIZE = 2  # ¬±2 —á–∞–Ω–∫–∞ (–±—ã–ª–æ ¬±1)
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É:
```bash
export ENABLE_QUERY_REFORMULATION=true
export ENABLE_MULTI_HOP=true
python main_pipeline.py search
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª `outputs/submission.csv`:

```csv
q_id,web_list
1,[45, 78, 12, 90, 34]
2,[23, 56, 89, 12, 45]
...
```

- `q_id` - ID –≤–æ–ø—Ä–æ—Å–∞
- `web_list` - —Å–ø–∏—Å–æ–∫ –∏–∑ 5 web_id (—Ç–æ–ø-5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)

---

## –ú–µ—Ç—Ä–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

Recall@5:
```
score = (—á–∏—Å–ª–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ —Ç–æ–ø-5) / (–æ–±—â–µ–µ —á–∏—Å–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö)
```

**–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | Accuracy | –í—Ä–µ–º—è |
|--------------|----------|-------|
| Baseline (–±–µ–∑ —É–ª—É—á—à–µ–Ω–∏–π) | 0.45-0.55 | 8—á |
| + BGE-M3 embeddings | 0.55-0.65 | 10—á |
| + RRF + Context Window | 0.75-0.85 | 12—á |
| + Grid Search –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | 0.80-0.88 | 14—á |
| + LLM cleaning | 0.85-0.92 | 20—á |
| + All —É–ª—É—á—à–µ–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º) | **0.90-0.95+** | 25—á |

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –Ω–∞ 10 –≤–æ–ø—Ä–æ—Å–∞—Ö
python main_pipeline.py all --limit 10
```

### –î–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
```bash
# –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –±–µ–∑ LLM (–±—ã—Å—Ç—Ä–æ)
python main_pipeline.py all
```

### –î–ª—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π:
```bash
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
python main_pipeline.py all --llm-clean --optimize
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Weaviate (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (Dense + BM25)
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –ë—ã—Å—Ç—Ä–µ–µ FAISS –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤

**–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Weaviate
docker-compose up -d

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç
pip install weaviate-client

# 3. –í–∫–ª—é—á–∏—Ç—å –≤ config
export USE_WEAVIATE=true

# 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
python main_pipeline.py build
python main_pipeline.py search
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: **[WEAVIATE_SETUP.md](WEAVIATE_SETUP.md)**

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ù–∞ A100 80GB:
- BUILD (–±–µ–∑ LLM): ~2-3 —á–∞—Å–∞
- BUILD (—Å LLM): ~6-8 —á–∞—Å–æ–≤
- SEARCH (–≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã): ~8-12 —á–∞—Å–æ–≤
- Grid Search (quick): ~1-2 —á–∞—Å–∞
- Grid Search (full): ~3-4 —á–∞—Å–∞

### –ù–∞ GTX 1080 Ti (11 GB):
- –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –≤ ~2-3 —Ä–∞–∑–∞
- LLM cleaning —Ç—Ä–µ–±—É–µ—Ç 8-bit –º–æ–¥–µ–ª—å (32-34 GB VRAM) - –º–æ–∂–µ—Ç –Ω–µ –ø–æ–º–µ—Å—Ç–∏—Ç—å—Å—è

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏:
```python
# –í src/config.py:

# –£–º–µ–Ω—å—à–∏—Ç—å TOP_K
TOP_K_DENSE = 15  # –±—ã–ª–æ 25
TOP_K_BM25 = 15   # –±—ã–ª–æ 25

# –û—Ç–∫–ª—é—á–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
ENABLE_QUERY_REFORMULATION = False
ENABLE_MULTI_HOP = False

# –ë—ã—Å—Ç—Ä—ã–π reranker
RERANKER_TYPE = "cross_encoder"  # –Ω–µ "llm"
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞:
- **[QUICKSTART.md](QUICKSTART.md)** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 3 –º–∏–Ω—É—Ç—ã
- **[CHEATSHEET.md](CHEATSHEET.md)** - –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
- **[FINAL_IMPROVEMENTS_SUMMARY.md](FINAL_IMPROVEMENTS_SUMMARY.md)** - üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –≤—Å–µ—Ö —É–ª—É—á—à–µ–Ω–∏–π
- **[NEW_IMPROVEMENTS_GUIDE.md](NEW_IMPROVEMENTS_GUIDE.md)** - üìö –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–ª—É—á—à–µ–Ω–∏—è–º

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:
- **[WEAVIATE_SETUP.md](WEAVIATE_SETUP.md)** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Weaviate
- **[QUICKSTART_WEAVIATE.md](QUICKSTART_WEAVIATE.md)** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Weaviate
- **[README_SERVER.md](README_SERVER.md)** - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è A100 —Å–µ—Ä–≤–µ—Ä–∞

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
- **[docs/FUTURE_IMPROVEMENTS.md](docs/FUTURE_IMPROVEMENTS.md)** - –ò–¥–µ–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π
- **[USAGE_EXAMPLES.md](USAGE_EXAMPLES.md)** - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## Troubleshooting

### LLM –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:
```bash
# –°–∫–∞—á–∞–π—Ç–µ Qwen3-32B-2507-Q8_0.gguf –≤ –ø–∞–ø–∫—É models/
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–∑ --llm-clean
```

### Weaviate –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Docker
docker-compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose down
docker-compose up -d

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ FAISS
export USE_WEAVIATE=false
```

### CUDA out of memory:
```python
# –£–º–µ–Ω—å—à–∏—Ç–µ batch size –≤ config.py
EMBEDDING_BATCH_SIZE = 64  # –±—ã–ª–æ 128
```

### Grid search —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–∏–π:
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ quick —Ä–µ–∂–∏–º
python main_pipeline.py search --optimize --optimize-mode quick

# –£–º–µ–Ω—å—à–∏—Ç–µ –≤—ã–±–æ—Ä–∫—É
python main_pipeline.py search --optimize --optimize-sample 30
```

---

## Changelog

### v2.0 (16 –Ω–æ—è–±—Ä—è 2025) - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω LLM preprocessing –≤ `build --llm-clean`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω Grid Search –≤ `search --optimize`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ 7 —É–ª—É—á—à–µ–Ω–∏–π RAG (RRF, Context Window, Query Reformulation –∏ –¥—Ä.)
- ‚úÖ –°—É–º–º–∞—Ä–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç accuracy: +70-115%
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### v1.0 - –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
- –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (Dense + BM25)
- Cross-Encoder reranking
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ FAISS –∏ Weaviate

---

## –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –ø–æ –ø–æ–∏—Å–∫—É —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞.

**–§–∏–Ω–∞–ª—å–Ω–∞—è accuracy:** 0.90-0.95+ (—Å –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π)

üöÄ –£–¥–∞—á–∏!
